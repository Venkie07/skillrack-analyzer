<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SkillRack Analyzer — Neon Simple</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
:root{
  --bg:#05020a;
  --card: rgba(255,255,255,0.02);
  --glass-border: rgba(255,255,255,0.04);
  --accent1: #7b61ff;
  --accent2: #00c6ff;
  --muted: rgba(255,255,255,0.6);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Segoe UI,Arial}
body{
  min-height:100vh;
  background:linear-gradient(180deg,#04020b 10%,#071026 100%);
  color:#dff6ff;
  padding:22px;
}
.container{max-width:900px;margin:0 auto}

/* Title Section */
header{
  display:flex;
  gap:14px;
  align-items:center;
  margin-bottom:18px;
}
.logo{
  width:56px;height:56px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent1),var(--accent2));
  display:flex;align-items:center;justify-content:center;
}
.logo i{color:#00121a;font-size:22px}
h1{font-size:22px}
p.lead{color:var(--muted);font-size:14px}

/* Input card */
.card{
  background:var(--card);
  border:1px solid var(--glass-border);
  padding:20px;
  border-radius:12px;
  backdrop-filter:blur(6px);
  box-shadow:0 8px 30px rgba(2,5,20,0.6);
  margin-bottom:14px;
  transition:0.4s ease;
}

/* Input row */
.input-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
input.url{
  flex:1;
  padding:12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background:transparent;
  color:#e8fbff;
  min-width:200px;
}
button.btn{
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  border:none;color:#02121a;
  padding:10px 14px;border-radius:10px;
  font-weight:700;cursor:pointer;
}

/* Profile section */
#profileSection{display:none;opacity:0;transition:opacity 0.4s ease}

.profile{display:flex;flex-direction:column;gap:14px}
.profile-head{
  display:flex;
  align-items:center;
  gap:12px;
}
.avatar{
  width:76px;height:76px;border-radius:14px;
  background:linear-gradient(135deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
  display:flex;align-items:center;justify-content:center;
  font-weight:800;color:var(--accent2);font-size:28px;
  border:1px solid rgba(255,255,255,0.02);
}
.points{
  margin-left:auto;
  padding:10px 14px;border-radius:10px;
  background:linear-gradient(90deg, rgba(123,97,255,0.12), rgba(0,198,255,0.06));
  text-align:center;
}
.value{font-size:18px;font-weight:800;color:var(--accent2)}

/* Stats row */
.stats-row{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
.stat{
  background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);
  padding:12px;border-radius:8px;text-align:center;
}
.stat .label{font-size:12px;color:var(--muted)}
.stat .num{font-size:18px;font-weight:800}

.info{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px;border-radius:8px;
  border:1px solid rgba(255,255,255,0.02)
}
.link a{color:var(--accent2);text-decoration:none;font-weight:700}

/* Check Another */
#resetBtn{
  margin-top:12px;
  display:none;
  padding:10px 14px;
  border-radius:10px;
  background:transparent;
  border:1px solid var(--accent2);
  color:var(--accent2);
  font-weight:700;
  cursor:pointer;
  width:100%;
  text-align:center;
}

/* Mobile */
@media(max-width:720px){
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .profile-head{flex-direction:row;gap:8px}
}
</style>
</head>

<body>
<div class="container">

  <!-- TITLE -->
  <header>
    <div class="logo"><i class="fa-solid fa-atom"></i></div>
    <div>
      <h1>SkillRack Profile Analyzer</h1>
      <p class="lead">Check your progress</p>
    </div>
  </header>


  <!-- INPUT SECTION -->
  <div id="inputSection" class="card">
    <div class="input-row">
      <input id="profileUrl" class="url" placeholder="Paste SkillRack profile URL">
      <button id="analyzeBtn" class="btn" onclick="fetchProfile()">Analyze</button>
    </div>
    <div style="margin-top:8px;color:var(--muted);font-size:13px">
    </div>
  </div>


  <!-- PROFILE SECTION -->
  <div id="profileSection" class="card profile">

    <div class="profile-head">
      <div class="avatar" id="avatar">SR</div>
      <div>
        <div style="font-size:18px;font-weight:800" id="userName">—</div>
        <div style="color:var(--muted);font-size:13px" id="userCollege">—</div>
      </div>

      <div class="points">
        <div style="font-size:12px;color:var(--muted)">Total Points</div>
        <div class="value" id="totalPoints">0</div>
      </div>
    </div>

    <div class="stats-row" style="margin-top:6px">
      <div class="stat"><div class="label">Problems Solved</div><div class="num" id="solvedCount">0</div></div>
      <div class="stat"><div class="label">Daily Challenge</div><div class="num" id="dcCount">0</div></div>
      <div class="stat"><div class="label">Daily Test</div><div class="num" id="dtCount">0</div></div>
      <div class="stat"><div class="label">Code Tutor</div><div class="num" id="tutorCount">0</div></div>
    </div>

    <div class="info" style="margin-top:10px">
      <div class="link"><a id="profileLink" href="#" target="_blank">Open on SkillRack</a></div>
    </div>
  </div>


  <!-- Check Another Profile -->
  <button id="resetBtn" onclick="resetForm()">Check Another Profile</button>

</div>


<script>
/* Helper */
function safe(v, d='—'){ return (v===undefined||v===null||v==='')?d:v }
function toInt(x){ const n=parseInt(x); return isNaN(n)?0:n }

/* Autofill last used URL */
window.onload = () => {
  const last = localStorage.getItem("lastSkillRackURL");
  if(last) document.getElementById("profileUrl").value = last;
};

/* Show Profile Data */
function display(data){
  const name = safe(data.name,'Unknown');
  const college = safe(data.college,'Unknown');
  
  document.getElementById("userName").innerText = name;
  document.getElementById("userCollege").innerText = college;

  document.getElementById("solvedCount").innerText = toInt(data.solved);
  document.getElementById("dcCount").innerText = toInt(data.dc);
  document.getElementById("dtCount").innerText = toInt(data.dt);
  document.getElementById("tutorCount").innerText = toInt(data.codeTutor);

  document.getElementById("totalPoints").innerText = toInt(data.points);

  const initials = name.split(" ").slice(0,2).map(s=>s[0]||'').join('').toUpperCase() || "SR";
  document.getElementById("avatar").innerText = initials;
  document.getElementById("profileLink").href = data.profile_url;
}

/* Fetch Profile */
let busy=false;
async function fetchProfile(){
  if(busy) return;

  const url = document.getElementById("profileUrl").value.trim();
  if(!url) return alert("Paste a SkillRack URL");

  busy = true;
  document.getElementById("analyzeBtn").innerHTML = "Working...";

  try{
    localStorage.setItem("lastSkillRackURL", url);

    const res = await fetch('/api/profile',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({url})
    });

    const data = await res.json();
    if(!res.ok) throw new Error(data.error || "Failed");

    display(data);

    document.getElementById("inputSection").style.display="none";
    const section = document.getElementById("profileSection");
    section.style.display="block";
    setTimeout(()=> section.style.opacity=1, 10);

    document.getElementById("resetBtn").style.display="block";

  }catch(err){
    alert(err.message);
  }finally{
    busy=false;
    document.getElementById("analyzeBtn").innerHTML = "Analyze";
  }
}

/* Reset / Check Another */
function resetForm(){
  document.getElementById("profileSection").style.opacity=0;

  setTimeout(()=>{
    document.getElementById("profileSection").style.display="none";
    document.getElementById("inputSection").style.display="block";
    document.getElementById("resetBtn").style.display="none";
  },300);
}
</script>

</body>
</html>
